

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/favicon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Bipedal Bit">
  <meta name="keywords" content="">
  
    <meta name="description" content="​    难得翻新了博客，正好把最近整的新活记录分享一下。 1 效果​    先看效果再讲过程，给缺耐心的读者节省时间。 1.1 类APP效果              安卓手机上的类app效果         open-webui首页效果         ​    很像移动端app客户端吧，实际上这是PWA。PWA（Progressive Web App，渐进式网络应用）是一种结合了网页和原生应">
<meta property="og:type" content="article">
<meta property="og:title" content="搭建私有LLM助手平台">
<meta property="og:url" content="https://blog.bipedalbit.net/2025/05/28/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89LLM%E5%8A%A9%E6%89%8B%E5%B9%B3%E5%8F%B0/index.html">
<meta property="og:site_name" content="Hacking to the gate!">
<meta property="og:description" content="​    难得翻新了博客，正好把最近整的新活记录分享一下。 1 效果​    先看效果再讲过程，给缺耐心的读者节省时间。 1.1 类APP效果              安卓手机上的类app效果         open-webui首页效果         ​    很像移动端app客户端吧，实际上这是PWA。PWA（Progressive Web App，渐进式网络应用）是一种结合了网页和原生应">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/ComfyUI_00283_resize.png">
<meta property="article:published_time" content="2025-05-28T14:19:35.000Z">
<meta property="article:modified_time" content="2025-05-28T16:36:32.238Z">
<meta property="article:author" content="Bipedal Bit">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="ollama">
<meta property="article:tag" content="open-webui">
<meta property="article:tag" content="oneapi">
<meta property="article:tag" content="mcpserver">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/ComfyUI_00283_resize.png">
  
  
  
  <title>搭建私有LLM助手平台 - Hacking to the gate!</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.bipedalbit.net","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hacking to the gate!</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/ComfyUI_00283_resize.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="搭建私有LLM助手平台"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-28 22:19" pubdate>
          2025年5月28日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          55 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">搭建私有LLM助手平台</h1>
            
            
              <div class="markdown-body">
                
                <p>​    难得翻新了博客，正好把最近整的新活记录分享一下。</p>
<h1 id="1-效果"><a href="#1-效果" class="headerlink" title="1 效果"></a>1 效果</h1><p>​    先看效果再讲过程，给缺耐心的读者节省时间。</p>
<h2 id="1-1-类APP效果"><a href="#1-1-类APP效果" class="headerlink" title="1.1 类APP效果"></a>1.1 类APP效果</h2><table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/IMG_20250525_194039.jpg" srcset="/img/loading.gif" lazyload>安卓手机上的类app效果</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-20-31-877_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>open-webui首页效果</center></td>
    </tr>
</table>


<p>​    很像移动端app客户端吧，实际上这是PWA。PWA（Progressive Web App，渐进式网络应用）是一种结合了网页和原生应用优势的新型应用形态。它通过现代Web技术实现以下核心特性：</p>
<ol>
<li><strong>渐进增强</strong><br>所有用户都能访问基础网页功能，但支持现代浏览器的用户可获得增强体验（如离线访问、推送通知等）。</li>
<li><strong>响应式设计</strong><br>自适应不同设备屏幕，提供无缝的移动体验。</li>
<li><strong>离线支持</strong><br>通过Service Worker缓存资源，即使网络中断也能访问关键内容。</li>
<li><strong>推送通知</strong><br>类似原生应用，可向用户发送实时通知（需用户授权）。</li>
<li><strong>可安装性</strong><br>用户可将PWA添加到主屏幕，形成类似原生应用的快捷方式（无需应用商店）。</li>
<li><strong>性能优化</strong><br>通过缓存策略和资源预加载，实现接近原生应用的加载速度。</li>
</ol>
<table>
<thead>
<tr>
<th>特性</th>
<th>传统Web应用</th>
<th>原生应用</th>
<th>PWA</th>
</tr>
</thead>
<tbody><tr>
<td>离线访问</td>
<td>不支持</td>
<td>支持</td>
<td>支持（通过缓存）</td>
</tr>
<tr>
<td>推送通知</td>
<td>不支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>安装方式</td>
<td>无需安装</td>
<td>需下载安装</td>
<td>可添加到主屏幕</td>
</tr>
<tr>
<td>跨平台兼容性</td>
<td>依赖浏览器</td>
<td>平台专属</td>
<td>一次开发多端运行</td>
</tr>
<tr>
<td>开发成本</td>
<td>低</td>
<td>高（需多平台开发）</td>
<td>中（Web技术）</td>
</tr>
</tbody></table>
<p>​    open-webui毕竟是基于web的UI，open-webui添加PWA支持前，我也一直在浏览器里使用。不过，私用的LLM助手，就算有鉴权、CDN、防DDos，我也不会贴公网url就是了，非工业方案薄弱环节应该还是挺多的。</p>
<h2 id="1-2-chat界面效果"><a href="#1-2-chat界面效果" class="headerlink" title="1.2 chat界面效果"></a>1.2 chat界面效果</h2><table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-23-46-437_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果1</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-26-36-331_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果2</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-29-08-235_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果3</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-29-27-184_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果4</center></td>
    </tr>
</table>

<table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-20-40-20-184_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果5</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-20-40-39-144_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>chat效果6</center></td>
    </tr>
</table>

<ul>
<li><p>chat界面右上角能点开参数配置面板，只影响当前会话，有大量LLM推理参数暴露。实际使用场景中，除了用Temperature调整文本生成的多样性倾向，我几乎不会调整这些参数。</p>
</li>
<li><p>chat界面左上角能点开模型选择列表，写文这会儿我的默认模型是本地的qwen3-14B，外部API接入模型和本地部署模型可以在同一个会话中交替选用，会话上下文对新加入会话的模型也保持可见。模型列表的搜索框也可以拉取ollama hub的新模型在本地部署。</p>
</li>
<li><p>MCP工具我多给点镜头，“+”号可以开启关闭模型可见的工具。所谓MCP（Model Context Protocol，模型上下文协议）就是令工具提示词使用标准的结构化形式，固化到工具中，同时这个工具调用形式在LLM训练阶段参与多任务模型微调。然而模型看着对话上下文和可用工具列表，最终怎么选用工具，就取决于具体模型的工具规划能力了。这里我用查询明天武汉天气作为例子，展示推理类模型利用时间查询工具和高德地图的城市天气查询工具，解决用户需求的过程。为什么我要分2步问？因为2次工具调用有顺序依赖关系，这类似一个工作流或者所谓的agentic任务规划过程。</p>
</li>
<li><p>能看到“+”号点开后能截图和上传文件，发送按钮左边有个语音输入按钮，支持多模态输入。</p>
</li>
<li><p>除了可以使用工具引入实时数据，也能用固定提示词和搜索引擎接口引入联网搜索结果作为上下文信息。实测这基本可以跟搜索引擎类MCP工具等同，但默认的联网搜索和RAG会在更大召回范围内先做文本编码，可以认为检索“视野”更宽，召回能力更强一些。</p>
</li>
<li><p>代码解释器我还没玩过，看了下配置选项，是python沙箱，我参与的大工程比较多，不太有代码片段可以玩沙箱。</p>
</li>
<li><p>模型响应框下方有TTS、重新生成、结果（Markdown格式）复制等等按钮，还挺全的。</p>
</li>
<li><p>截图右上角能看到我用的是蜂巢网络（中国移动运营商），没开梯子，所以理论上来说，有网的地方我都能用这个私有LLM助手平台。</p>
</li>
<li><p>右下方有open-webui的版本更新提示，拉新镜像重新部署一下就能更新。</p>
</li>
</ul>
<h2 id="1-3-平台配置效果"><a href="#1-3-平台配置效果" class="headerlink" title="1.3 平台配置效果"></a>1.3 平台配置效果</h2><table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-30-38-565_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果1</center></td>
    </tr>
</table>

<table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-31-29-519_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果2</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-31-50-645_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果3</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-32-07-909_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果4</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-32-37-040_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果5</center></td>
    </tr>
</table>

<table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-34-09-990_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果6</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-34-32-447_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果7</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-34-48-225_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果8</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-35-08-724_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果9</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/Screenshot_2025-05-25-19-36-02-805_com.android.chrome.jpg" srcset="/img/loading.gif" lazyload>平台配置效果10</center></td>
    </tr>
</table>

<ul>
<li><p>首先open-webui有用户、鉴权、角色、用户组管理功能。私用嘛，现在整个平台就我一个用户。</p>
</li>
<li><p>外部连接有两个用途，以OpenAI格式（注意这是LLM厂商的接口风格，跟OpenAPI的通用接口规范不是一回事）对接厂商模型API，以ollama格式对接本地部署模型。如果厂商不是OpenAI格式呢？后面我会讲。</p>
</li>
<li><p>模型配置里，可以看到所有的外部接入、本地部署模型，可以单独配置模型是否启动、默认推理参数、系统提示词、默认可用工具列表、是否显示usage等配置项。右上角的下载按钮点开可以跟ollama交互增删本地模型。</p>
</li>
<li><p>工具配置里可以给每个工具配置OpenAPI规范的API，可以看到其实我也配了有搜索引擎性质的github、arxiv、searxng MCP工具，来引入实时的领域或开放信息。如果工具不是OpenAPI规范呢？后面我会讲。</p>
</li>
<li><p>open-webui的这种工具接入形式，目前还只能扩展上下文，还属于RAG的变种形式，如果想实现agent，做多阶段的工具链规划与调用，需要用到open-webui的pipeline配置。这个我还没玩过，个人使用，还没那么多固化的复杂工作流想配。</p>
</li>
<li><p>联网搜索能配相当多的搜索引擎接口类型，我是用自己部署的searxng这个元搜索引擎（能个性化定制、自行整合多个搜索引擎的结果）。</p>
</li>
<li><p>代码解释器配置，能看到是两个python轻量沙箱，这类沙箱的通病是跑跑抽象代码片段还行，依赖包一复杂，工程体量一大就麻烦了，毕竟不是conda、docker这种能做一定程度环境隔离的重沙箱。</p>
</li>
<li><p>提示词配置，是PE（Prompt Engineering，提示词工程）时代遗留的功能，我是没使用场景的。果然模型迭代一快，大量提示词都要变成摆设，而模型一定会快速迭代。</p>
</li>
<li><p>语音功能配置，用来配语音转文本模型和文本转语音模型。我不太爱靠说话交流，保留默认配置。</p>
</li>
</ul>
<h1 id="2-契机与遗憾"><a href="#2-契机与遗憾" class="headerlink" title="2 契机与遗憾"></a>2 契机与遗憾</h1><p>​    2024年11月左右，我终于有了自己梦寐以求的N卡台式机和NAS。彼时开源生态支持完善的qwen2.5刚发布不久，我想把这些烧钱设备变成生产力的热情高涨。</p>
<p>​    我的显卡是NVIDIA 4070Ti Super，NAS是群晖DS224+。现在看这两个型号选择都留了点暗坑，后来人引以为戒：</p>
<ul>
<li><p>4070tis虽然算力OK，但显存只有16GB，复现不了工业场景常用的24GB显存（比如4090卡）轻量部署方案。通常只够部署14B规模（140亿参数量，模型文件大概9GB出头，模型推理占显存10GB出头）的模型。模型参数量到显存空间的换算过程我在这里先不展开聊。</p>
</li>
<li><p>DS224+这NAS算群晖最新的入门款，2开头就是2盘位，够用，何况之前我为了从复旦的NLP实验室搞语料买了个16T黑盘，虽然不能用来组RAID但可以用来外接扩展。坑在于我家明明做了全屋超6类网线，具备户内万兆通信的基础，可这款NAS只有2个1Gb的网口，也就是最多做双通道的千兆通信，顶天2千兆带宽，读写大文件时，NAS网口成IO瓶颈了┓(´∀&#96; )┏。</p>
</li>
</ul>
<h1 id="3-核心方案选型"><a href="#3-核心方案选型" class="headerlink" title="3 核心方案选型"></a>3 核心方案选型</h1><p>​    我长期在微博上跟进AI开源圈的消息，爱可可-爱生活（号主是北邮模式识别实验室的陈老师）、黄建同学（前微软高工）、宝玉xp（前微软高工），都是不错的大V，2024年整年AI开源壳工具层出不穷。</p>
<p>​    优秀、高性能的通用本地LLM推理工具<a target="_blank" rel="noopener" href="https://github.com/ollama/ollama">ollama</a>脱颖而出，迅速占据本地LLM推理事实开源方案标准的地位。<a target="_blank" rel="noopener" href="https://github.com/ollama/ollama">ollama</a>的配套生态迅速发展，它的官推UI壳<a target="_blank" rel="noopener" href="https://github.com/open-webui/open-webui">open-webui</a>也进入我的视线，后来这个UI壳更是迅速扩展成了相当流行的通用AI壳甚至是小规模AI应用平台（能chat，能多模态交互，能建工作流，能RAG，能接工具包括后来的MCP工具）。</p>
<p>​    于是，ollama搞定部署、open-webui搞定前后端的方案主体敲定了。</p>
<h1 id="4-完善方案"><a href="#4-完善方案" class="headerlink" title="4 完善方案"></a>4 完善方案</h1><h2 id="4-1-痛点"><a href="#4-1-痛点" class="headerlink" title="4.1 痛点"></a>4.1 痛点</h2><p>​    本地部署ollama和open-webui很顺利，完成demo验证后，一些瓶颈问题浮现：</p>
<ol>
<li><p>各家厂商的开源模型中，我希望本地部署体验的模型很多，会迅速占用大量磁盘空间；</p>
</li>
<li><p>我当然希望在上班或者不在家时也能随时随地使用LLM助手；</p>
</li>
<li><p>除了本地部署的算力受限的几种开源模型，必要的时候我也希望在同一个应用里白嫖厂商开放的LLM；</p>
</li>
<li><p>我的PC不可能永远用来跑模型，有时会关机，有时会用来切win系统打游戏（我装了双系统，win用来娱乐，ubuntu用来开发和当服务器）。</p>
</li>
</ol>
<h2 id="4-2-解法"><a href="#4-2-解法" class="headerlink" title="4.2 解法"></a>4.2 解法</h2><table>
<thead>
<tr>
<th>需求</th>
<th>解决方案</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>本地模型存储</td>
<td>NAS NFS挂载</td>
<td>空间不受限，RAID可靠，14B模型初次换入加载在1min左右耗时可接受。</td>
</tr>
<tr>
<td>外网暴露</td>
<td><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a> + 自有域名 + 自有VPS</td>
<td>frp写文时已经94.3k star的golang开源老牌内网穿透工具，有自有域名和VPS的情况下，比运营商固定IP灵活很多，性能要求不苛刻，实测时延几乎不可感知。</td>
</tr>
<tr>
<td>模型API归一化</td>
<td><a target="_blank" rel="noopener" href="https://github.com/songquanpeng/one-api">one-api</a></td>
<td>写文时已经25.4k star的开源LLM API 管理 &amp; 分发系统，适配了国内外几乎所有让人有接入意愿的通用LLM厂商API。</td>
</tr>
<tr>
<td>部署拓扑</td>
<td>见下图</td>
<td>ollama在PC，open-webui、frpc在NAS，frps、one-api、nginx、ssl在VPS，兼顾可维护性、网络可达要求、VPS轻量原则。</td>
</tr>
</tbody></table>
<p><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/bipedalbit-open-webui-deploy.svg" srcset="/img/loading.gif" lazyload alt="BipedalBit Open-WebUI部署拓扑"></p>
<h1 id="5-实现详情"><a href="#5-实现详情" class="headerlink" title="5 实现详情"></a>5 实现详情</h1><h2 id="5-1-PC"><a href="#5-1-PC" class="headerlink" title="5.1 PC"></a>5.1 PC</h2><p>​    按照我的个人习惯，给PC装双系统，win平台娱乐，ubuntu系统下做开发，也适合作为服务长期运行（例如我出门在外时）的服务器环境。</p>
<h3 id="5-1-1-NAS挂载"><a href="#5-1-1-NAS挂载" class="headerlink" title="5.1.1 NAS挂载"></a>5.1.1 NAS挂载</h3><h4 id="安装NFS客户端"><a href="#安装NFS客户端" class="headerlink" title="安装NFS客户端"></a>安装NFS客户端</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt install nfs-common<br></code></pre></td></tr></table></figure>

<h4 id="挂载NFS共享目录"><a href="#挂载NFS共享目录" class="headerlink" title="挂载NFS共享目录"></a>挂载NFS共享目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mount -t nfs &lt;NFS服务器IP&gt;:/&lt;共享路径&gt; /&lt;本地挂载点&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">示例</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">sudo</span> mount -t nfs 192.168.1.100:/shared_folder /mnt/nfs</span><br></code></pre></td></tr></table></figure>
<ul>
<li><code>&lt;NFS服务器IP&gt;</code>：NFS服务器的IP地址</li>
<li><code>/&lt;共享路径&gt;</code>：NFS服务器上共享的目录路径</li>
<li><code>/&lt;本地挂载点&gt;</code>：Ubuntu系统上用于挂载的本地目录（需提前创建）</li>
</ul>
<h4 id="检查挂载点"><a href="#检查挂载点" class="headerlink" title="检查挂载点"></a>检查挂载点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls /mnt/nfs<br></code></pre></td></tr></table></figure>

<h4 id="配置开机自动挂载"><a href="#配置开机自动挂载" class="headerlink" title="配置开机自动挂载"></a>配置开机自动挂载</h4><p>​    编辑 &#x2F;etc&#x2F;fstab 文件，添加以下行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">NFS服务器IP</span>&gt;</span>:/<span class="hljs-tag">&lt;<span class="hljs-name">共享路径</span>&gt;</span>  /<span class="hljs-tag">&lt;<span class="hljs-name">本地挂载点</span>&gt;</span>  nfs  defaults  0  0<br></code></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.1.100</span>:/shared_folder  /mnt/nfs  nfs  defaults  <span class="hljs-number">0</span>  <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h3 id="5-1-2-ollama"><a href="#5-1-2-ollama" class="headerlink" title="5.1.2 ollama"></a>5.1.2 ollama</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">ollama:</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">$&#123;OLLAMA_DATA_DIR-~/workspace/docker-data/ollama-data&#125;:/root/.ollama</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">ollama</span><br>    <span class="hljs-attr">pull_policy:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ollama/ollama:$&#123;OLLAMA_DOCKER_TAG-latest&#125;</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">reservations:</span><br>          <span class="hljs-attr">devices:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">driver:</span> <span class="hljs-string">nvidia</span><br>              <span class="hljs-attr">device_ids:</span> [<span class="hljs-string">&#x27;0&#x27;</span>]<br>              <span class="hljs-attr">capabilities:</span> [<span class="hljs-string">gpu</span>]<br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">$&#123;OLLAMA_WEBAPI_PORT-11434&#125;:11434</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;NVIDIA_VISIBLE_DEVICES=all&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;CUDA_MPS_ENABLE=1&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;CUDA_CACHE_PATH=/tmp&#x27;</span><br>      <span class="hljs-comment"># - &#x27;CUDA_LAUNCH_BLOCKING=1&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;OLLAMA_MAX_GPU_MEMORY=16000&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;OLLAMA_USE_GPU=1&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;HTTP_PROXY=http://****:10809&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;HTTPS_PROXY=http://****:10809&#x27;</span><br>    <span class="hljs-comment"># 容器内忽然无法使用GPU问题，已经用以下方案解决：</span><br>    <span class="hljs-comment"># 在 /etc/docker/daemon.json 中添加 &quot;exec-opts&quot;: [&quot;native.cgroupdriver=cgroupfs&quot;]</span><br>    <span class="hljs-comment"># 等待5s防止nfs未挂载完成</span><br>    <span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>]<br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;sleep 5 &amp;&amp; exec /bin/ollama serve&quot;</span>]<br></code></pre></td></tr></table></figure>

<ul>
<li><code>pull_policy: always</code>让我每次重启ollama时都能自动更新。</li>
<li><code>HTTP_PROXY=http://****:10809</code>和<code>HTTPS_PROXY=http://****:10809</code>是在配代理，从ollama的模型hub拉开源模型是ollama自身的行为，所以它需要用梯子的。配置的是局域网里的梯子v2ray客户端地址，比如，可以在NAS上。</li>
<li><code>OLLAMA_MAX_GPU_MEMORY=16000</code>是因为我显卡显存16GB，大家看自己情况调整。</li>
<li>在<code>/etc/docker/daemon.json</code>中添加<code>&quot;exec-opts&quot;: [&quot;native.cgroupdriver=cgroupfs&quot;]</code>解容器偶发掉卡问题还挺难查的。</li>
<li>用sleep解重新开机时容器启动早于NFS挂载就绪的问题挺偷懒的，我觉得应该有更优雅的解法。</li>
</ul>
<h2 id="5-2-NAS"><a href="#5-2-NAS" class="headerlink" title="5.2 NAS"></a>5.2 NAS</h2><p>​    群晖NAS让我很喜欢的一点就是可以玩docker容器，甚至docker-compose项目也支持。这样一些希望常驻且磁盘IO或容量要求高的应用就可以部署在NAS上了。</p>
<h3 id="5-2-1-v2ray（客户端）"><a href="#5-2-1-v2ray（客户端）" class="headerlink" title="5.2.1 v2ray（客户端）"></a>5.2.1 v2ray（客户端）</h3><p>​    2025年海外docker镜像仓库包括docker官方仓库都在国内有访问障碍，为了方便拉镜像做部署，最简单的解决方案就是利用VPS搭个梯子了，有现成梯子当然也可以用。早些年，梯子客户端还是shadowsocks，这两年我也紧跟时代换成了v2ray生态的各种变种客户端和clash，个人感觉相比起来v2ray会比clash上手更方便、灵活一些。<br>​    首先要准备一个目录，来装几个必要文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">v2ray<br>├── localtime<br>├── timezone<br>└── v2ray<br>    ├── config.json<br>    ├── geoip.dat<br>    ├── geoip.metadb<br>    ├── geoip-only-cn-private.dat<br>    └── geosite.dat<br></code></pre></td></tr></table></figure>
<ul>
<li>localtime、timezone是为了保证v2ray客户端和服务端的时钟保持一致，不一致通信会不通的。起容器时会挂载进去替换docker镜像里的原始文件。</li>
<li>v2ray子目录里是v2ray客户端依赖的资源文件，其中geoip是各种网络局域辅助判定规则集，跟GFW打交道的。</li>
<li><code>v2ray/config.json</code>是v2ray客户端的核心配置文件，通常可以用图形界面的v2ray客户端配置完后复制出来用，或者网上找一份改改用。大概长这样：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10808</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;tls&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10809</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;tls&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;vnext&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> ****<span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>              <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;alterId&quot;</span><span class="hljs-punctuation">:</span> ****<span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;security&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;auto&quot;</span><br>              <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tcp&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;mux&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;response&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;hosts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;dns.google&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;proxy.example.com&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;geosite:cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;geosite:geolocation-cn&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;expectIPs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;geoip:cn&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;1.1.1.1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;https://dns.google/dns-query&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;bipedalbit.net&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;routing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;domainStrategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AsIs&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;inboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;api&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;api&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;domain:googleapis.cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:gstatic.com&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;443&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;udp&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;geosite:category-ads-all&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;geoip:private&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;geosite:private&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;223.5.5.5/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;223.6.6.6/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;2400:3200::1/128&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;2400:3200:baba::1/128&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;119.29.29.29/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;1.12.12.12/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;120.53.53.53/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;2402:4e00::/128&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;2402:4e00:1::/128&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;180.76.76.76/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;2400:da00::6666/128&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;114.114.114.114/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;114.114.115.115/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;180.184.1.1/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;180.184.2.2/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;101.226.4.6/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;218.30.118.6/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;123.125.81.6/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;140.207.198.6/32&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;geoip:cn&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-string">&quot;domain:dns.alidns.com&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:doh.pub&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:dot.pub&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:doh.360.cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:dot.360.cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;geosite:cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;geosite:geolocation-cn&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-string">&quot;domain:bipedalbit.net&quot;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0-65535&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>​    接下来是docker-compose.yaml：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">v2ray-client:</span><br>    <span class="hljs-attr">mage:</span> <span class="hljs-string">v2fly/v2fly-core</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">v2ray-client</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">host</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./v2ray:/etc/v2ray</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./localtime:/etc/localtime</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./timezone:/etc/timezone</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-2-open-webui"><a href="#5-2-2-open-webui" class="headerlink" title="5.2.2 open-webui"></a>5.2.2 open-webui</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">open-webui:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/open-webui/open-webui:$&#123;WEBUI_DOCKER_TAG-main&#125;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">open-webui</span><br>    <span class="hljs-attr">pull_policy:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.:/app/backend/data</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ollama</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span><br>    <span class="hljs-attr">extra_hosts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">host.docker.internal:host-gateway</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;HTTP_PROXY=http://****:10809&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;http_proxy=http://****:10809&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;HTTPS_PROXY=http://****:10809&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;https_proxy=http://****:10809&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;OLLAMA_BASE_URL=http://****:11434&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;WEBUI_SECRET_KEY=&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;WEBUI_URL=https://****&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;ENABLE_WEBSOCKET_SUPPORT=true&#x27;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-3-frpc"><a href="#5-2-3-frpc" class="headerlink" title="5.2.3 frpc"></a>5.2.3 frpc</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">frpc:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">snowdreamtech/frpc</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">frpc</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">host</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./frpc.toml:/etc/frp/frpc.toml</span><br></code></pre></td></tr></table></figure>
<p>​    frp客户端配置文件frpc.toml长这样：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-attr">serverAddr</span> = <span class="hljs-string">&quot;bipedalbit.net&quot;</span><br><span class="hljs-attr">serverPort</span> = ****<br><span class="hljs-attr">auth.token</span> = <span class="hljs-string">&quot;****&quot;</span><br><br><span class="hljs-section">[[proxies]]</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;open-webui&quot;</span><br><span class="hljs-attr">type</span> = <span class="hljs-string">&quot;tcp&quot;</span><br><span class="hljs-attr">localIP</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><span class="hljs-attr">localPort</span> = <span class="hljs-number">8080</span><br><span class="hljs-attr">remotePort</span> = <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure>
<p>​    不清楚的地方可以看<a target="_blank" rel="noopener" href="https://gofrp.org/zh-cn/docs/examples/">frp官方文档</a>。</p>
<h3 id="5-2-4-mcpo2"><a href="#5-2-4-mcpo2" class="headerlink" title="5.2.4 mcpo2"></a>5.2.4 mcpo2</h3><p>​    <a target="_blank" rel="noopener" href="https://github.com/open-webui/mcpo">mcpo</a>是open-webui团队发起的开源项目，用python FastAPI框架写的，旨在快速启动OpenAPI规范接口的mcpserver，有鉴权功能，自解释、更方便部署在云上，方便各种平台接入。贴几张图让大家理解下OpenAPI的好处：</p>
<table>
    <tr>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/截图_2025-05-29_00-24-24.png" srcset="/img/loading.gif" lazyload>OpenAPI格式的MCP服务 /docs</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/截图_2025-05-29_00-24-55.png" srcset="/img/loading.gif" lazyload>OpenAPI格式的MCP服务 接口列表</center></td>
        <td ><center><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/截图_2025-05-29_00-25-27.png" srcset="/img/loading.gif" lazyload>OpenAPI格式的MCP服务 接口详情</center></td>
    </tr>
</table>

<p>​    NAS上这个mcpo服务跟VPS上的从部署方式看一模一样，用来对接只限国内的mcp工具服务，比如高德地图。</p>
<p>​    我魔改了一下原镜像，换了个启动脚本，方便用环境变量配API_KEY：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># @Author: zhangyipeng1</span><br><span class="hljs-comment"># @Date:   2025-05-15 18:12:11</span><br><span class="hljs-comment"># @Last Modified by:   wps</span><br><span class="hljs-comment"># @Last Modified time: 2025-05-15 18:12:23</span><br>mcpo --config /app/config.json --api-key <span class="hljs-string">&quot;<span class="hljs-variable">$API_KEY</span>&quot;</span><br></code></pre></td></tr></table></figure>
<p>​    通过套壳Dockerfile把启动脚本放入镜像：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> ghcr.io/open-webui/mcpo:main<br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./start.sh /app/start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /app/start.sh</span><br><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;/app/start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure>
<p>​    mcp配置文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;amap-maps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;@amap/amap-maps-mcp-server&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;AMAP_MAPS_API_KEY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;mcp-server-time&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;--local-timezone=Asia/Shanghai&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uvx&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;fetch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;mcp-server-fetch&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uvx&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>​    接下来是docker-compose.yaml，不指定镜像而是从Dockerfile构建镜像：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mcpo:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8090:8000&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">API_KEY:</span> <span class="hljs-string">****</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./config.json:/app/config.json</span><br></code></pre></td></tr></table></figure>

<h2 id="5-3-VPS"><a href="#5-3-VPS" class="headerlink" title="5.3 VPS"></a>5.3 VPS</h2><p>​    如果只打算维护一台云主机，那么选择一个海外VPS更能满足全球资源拉取、全球信息获取、搭建全球化应用的需求。VPS厂商挺多的就不细说了，我选了个洛杉矶的机房，全球主流资源访问速度和回国网速都不错。</p>
<p>​    VPS也装ubuntu，开发环境尽量跟PC保持统一，给自己降低心智负担。</p>
<h3 id="5-3-1-v2ray（服务端）"><a href="#5-3-1-v2ray（服务端）" class="headerlink" title="5.3.1 v2ray（服务端）"></a>5.3.1 v2ray（服务端）</h3><p><a target="_blank" rel="noopener" href="https://233boy.com/v2ray/v2ray-script/">一个很方便的v2ray服务端一键部署工具</a></p>
<h3 id="5-3-2-frps"><a href="#5-3-2-frps" class="headerlink" title="5.3.2 frps"></a>5.3.2 frps</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">frps:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">snowdreamtech/frps</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">frps</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:8080:8080&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;****:****&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">~/frp/frps.toml:/etc/frp/frps.toml</span><br></code></pre></td></tr></table></figure>
<p>​    frp服务端配置文件frps.toml长这样：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-attr">bindPort</span> = ****<br><span class="hljs-attr">auth.token</span> = <span class="hljs-string">&quot;****&quot;</span><br></code></pre></td></tr></table></figure>
<p>​    不清楚的地方可以看<a target="_blank" rel="noopener" href="https://gofrp.org/zh-cn/docs/examples/">frp官方文档</a>。</p>
<h3 id="5-3-3-one-api"><a href="#5-3-3-one-api" class="headerlink" title="5.3.3 one-api"></a>5.3.3 one-api</h3><p>​    one-api是用来汇聚各厂商的LLM接口，将各种厂商LLM接口统一为OpenAI格式，方便统一接入和灵活切换，渠道管理功能挺完善的：</p>
<p><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/%E6%88%AA%E5%9B%BE_2025-05-28_21-33-49.png" srcset="/img/loading.gif" lazyload alt="one-api"></p>
<p>​    但是需要注意：</p>
<ul>
<li>如果把one-api部署在海外，可能连不上部分国内厂商的接口，例如阿里的百炼平台。</li>
<li>VPS上用容器部署服务时，如果不打算让服务直接暴露到外网，务必注意暴露端口要带上ip限制，例如<code>127.0.0.1:3000:3000</code>。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.4&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;$&#123;REGISTRY:-docker.io&#125;/redis:latest&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">&quot;****&quot;</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">&quot;oneapi&quot;</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">&quot;****&quot;</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">&quot;one-api&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">~/mysql-data:/var/lib/mysql</span><br><br>  <span class="hljs-attr">one-api:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;$&#123;REGISTRY:-docker.io&#125;/justsong/one-api:latest&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">one-api</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:3000:3000&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>      <span class="hljs-attr">SQL_DSN:</span> <span class="hljs-string">&quot;oneapi:****@tcp(db:3306)/one-api?charset=utf8mb4&quot;</span><br>      <span class="hljs-attr">REDIS_CONN_STRING:</span> <span class="hljs-string">&quot;redis://redis&quot;</span><br>      <span class="hljs-attr">SESSION_SECRET:</span> <span class="hljs-string">&quot;****&quot;</span><br>     <span class="hljs-comment"># NODE_TYPE: slave  # 多机部署时从节点取消注释该行</span><br>     <span class="hljs-comment"># SYNC_FREQUENCY: 60  # 需要定期从数据库加载数据时取消注释该行</span><br>     <span class="hljs-comment"># FRONTEND_BASE_URL: &quot;https://****&quot;  # 多机部署时从节点取消注释该行</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">~/one-api:/data</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span> <span class="hljs-string">&gt;</span><br><span class="hljs-string">        wget -qO- http://localhost:3000/api/status | </span><br><span class="hljs-string">        grep -o &#x27;\&quot;success\&quot;:\\s*true&#x27; &gt; /dev/null &amp;&amp; echo &#x27;healthy&#x27; || echo &#x27;unhealthy&#x27;</span><br><span class="hljs-string"></span>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">command:</span><br>      [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env &amp;&amp; exec /one-api&quot;</span>]<br></code></pre></td></tr></table></figure>

<h3 id="5-3-4-searxng"><a href="#5-3-4-searxng" class="headerlink" title="5.3.4 searxng"></a>5.3.4 searxng</h3><p>​    <a target="_blank" rel="noopener" href="https://github.com/searxng/searxng">searxng</a>是一个开源的元搜索引擎，能配置多个搜索引擎作为自己的数据源，保护隐私，无广告。</p>
<p><img src="https://cdn.minio.bipedalbit.net/bipedalbit-net-images/open-webui/%E6%88%AA%E5%9B%BE_2025-05-28_21-41-35.png" srcset="/img/loading.gif" lazyload alt="searxng"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.7&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">searxng-redis:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">searxng-redis</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/valkey/valkey:8-alpine</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">valkey-server</span> <span class="hljs-string">--save</span> <span class="hljs-number">30</span> <span class="hljs-number">1</span> <span class="hljs-string">--loglevel</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">searxng</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/searxng/valkey-data:/data:rw</span><br>    <span class="hljs-attr">logging:</span><br>      <span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;json-file&quot;</span><br>      <span class="hljs-attr">options:</span><br>        <span class="hljs-attr">max-size:</span> <span class="hljs-string">&quot;1m&quot;</span><br>        <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;1&quot;</span><br><br>  <span class="hljs-attr">searxng:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">searxng</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/searxng/searxng:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">searxng</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:8081:8080&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/searxng/searxng:/etc/searxng:rw</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SEARXNG_BASE_URL=https://****/</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SEARXNG_REDIS_URL=redis://@searxng-redis:6379/0</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">UWSGI_WORKERS=$&#123;SEARXNG_UWSGI_WORKERS:-4&#125;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">UWSGI_THREADS=$&#123;SEARXNG_UWSGI_THREADS:-4&#125;</span><br>    <span class="hljs-attr">cap_drop:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span><br>    <span class="hljs-attr">cap_add:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">CHOWN</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SETGID</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SETUID</span><br>    <span class="hljs-attr">logging:</span><br>      <span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;json-file&quot;</span><br>      <span class="hljs-attr">options:</span><br>        <span class="hljs-attr">max-size:</span> <span class="hljs-string">&quot;1m&quot;</span><br>        <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;1&quot;</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">searxng:</span><br></code></pre></td></tr></table></figure>
<p>​    虽然挂载了一个目录，暴露了几个配置文件出来，但其实我也没修改过里面的配置。</p>
<h3 id="5-3-5-mcpo1"><a href="#5-3-5-mcpo1" class="headerlink" title="5.3.5 mcpo1"></a>5.3.5 mcpo1</h3><p>​    跟NAS上的mcpo2没什么大区别，只是里面配的mcp连海外工具。我只贴个配置文件吧：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;arxiv-mcp-server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;tool&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;run&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;arxiv-mcp-server&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;--storage-path&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;/app/arxiv-data&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uv&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;fetch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;mcp-server-fetch&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uvx&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;github&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;@modelcontextprotocol/server-github&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;mcp-server-firecrawl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;firecrawl-mcp&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;FIRECRAWL_API_KEY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;****&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;searxng&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;mcp-searxng&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;SEARXNG_URL&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://****&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;mcp-server-time&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;--local-timezone=Asia/Shanghai&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uvx&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="5-3-6-nginx-ssl"><a href="#5-3-6-nginx-ssl" class="headerlink" title="5.3.6 nginx+ssl"></a>5.3.6 nginx+ssl</h3><p>​    我VPS上部署的所有开放外网访问的服务，统一经由nginx暴露，顺便配上SSL证书。现在的SSL证书不像早年要么花钱要么搞自签的形式证书了，我们有了<a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a>这个SSL证书公益签发机构，还有<a target="_blank" rel="noopener" href="https://certbot.eff.org/">certbot</a>工具可以快速配置证书。现在自建站还花钱买SSL证书的我觉得就有点花冤枉钱了。</p>
<p>​    nginx配置文件我贴些open-webui相关的关键片段吧：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>  <span class="hljs-attribute">server_name</span> ****;<br>        <br>  <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/****/fullchain.pem;<br>  <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/****/privkey.pem;<br><br>  <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br><br>  <span class="hljs-section">location</span> /ws/socket.io/ &#123;<br>    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="hljs-string">&#x27;wss://****&#x27;</span>;<br>    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="hljs-string">&#x27;GET, OPTIONS&#x27;</span>;<br>    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="hljs-string">&#x27;Origin, Content-Type, Accept, Authorization, Upgrade, Sec-WebSocket-Key, Sec-WebSocket-Version, Sec-WebSocket-Extensions&#x27;</span>;<br>    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="hljs-string">&#x27;true&#x27;</span>;<br><br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> = <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) &#123;<br>      <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="hljs-string">&#x27;wss://****&#x27;</span>;<br>      <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="hljs-string">&#x27;GET, OPTIONS&#x27;</span>;<br>      <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="hljs-string">&#x27;Origin, Content-Type, Accept, Authorization, Upgrade, Sec-WebSocket-Key, Sec-WebSocket-Version, Sec-WebSocket-Extensions&#x27;</span>;<br>      <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="hljs-string">&#x27;true&#x27;</span>;<br>      <span class="hljs-attribute">return</span> <span class="hljs-number">204</span>; <span class="hljs-comment"># No Content</span><br>    &#125;<br><br>    <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">&quot;upgrade&quot;</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    <span class="hljs-attribute">proxy_cache_bypass</span> <span class="hljs-variable">$http_upgrade</span>;<br><br>    <span class="hljs-attribute">proxy_pass</span> http://localhost:8080;<br>    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">10s</span>;<br>    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">3600s</span>;<br>  &#125;<br>  <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">client_max_body_size</span>  <span class="hljs-number">64m</span>;<br>                <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Accept-Encoding gzip;<br>                <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>                <span class="hljs-attribute">proxy_cache</span> <span class="hljs-literal">off</span>;<br>                <span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>;<br>                <span class="hljs-attribute">chunked_transfer_encoding</span> <span class="hljs-literal">on</span>;<br>                <span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;<br>                <span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;<br>                <span class="hljs-attribute">keepalive_timeout</span> <span class="hljs-number">60s</span>;<br><br>    <span class="hljs-attribute">proxy_pass</span> http://localhost:8080;<br>    <span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br>    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">10s</span>;<br>    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">300s</span>;<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p><em>注意里面有些专门为websocket添加的配置，是趟过坑才成型的。</em></p>
<h3 id="5-3-7-域名"><a href="#5-3-7-域名" class="headerlink" title="5.3.7 域名"></a>5.3.7 域名</h3><p>​    域名服务商也挺多的，负责维护域名归属关系，有资质能出具域名归属证书，国内的域名服务商还能代办域名备案。费用从一年十来块到一年几百块的都有，看自己需要选择就好。</p>
<h3 id="5-3-8-DNS"><a href="#5-3-8-DNS" class="headerlink" title="5.3.8 DNS"></a>5.3.8 DNS</h3><p>​    自建站有很多人爱用cloudfare做DNS、CDN、对象存储、AI网关，这家赛博活菩萨有很多免费云基建服务。我最早也用cloudfare做域名解析，后来发现在国内偶发不可用，可能国内白嫖的人太多，节点负载太高了。现在我用同样免费的DNSPod做域名解析，最早是独立DNS，现在被腾讯云吞了。</p>
<h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6 总结"></a>6 总结</h1><p>​    这一套操作下来，你应该也能搭一套自己的AI助手平台。即使是缺显卡，也能部署整套系统的主体部分（不要ollama，只要one-api甚至连one-api都不要，只配国内厂商的接口）。</p>
<p>​    整个系统陆续添砖加瓦搭了几个月，想想踩了这么多坑，不记录下来确实挺可惜。</p>
<p>​    时隔9年又开始写博客，写完才发现这篇文格外的长。欢迎爱折腾的同好讨论~</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/LLM/" class="category-chain-item">LLM</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/LLM/" class="print-no-link">#LLM</a>
      
        <a href="/tags/ollama/" class="print-no-link">#ollama</a>
      
        <a href="/tags/open-webui/" class="print-no-link">#open-webui</a>
      
        <a href="/tags/oneapi/" class="print-no-link">#oneapi</a>
      
        <a href="/tags/mcpserver/" class="print-no-link">#mcpserver</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>搭建私有LLM助手平台</div>
      <div>https://blog.bipedalbit.net/2025/05/28/搭建私有LLM助手平台/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Bipedal Bit</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年5月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2016/06/23/sai%E6%9D%BF%E7%BB%98%E5%88%9D%E4%BD%93%E9%AA%8C/" title="sai板绘初体验">
                        <span class="hidden-mobile">sai板绘初体验</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.css')
      Fluid.utils.createScript('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.js', function() {
        var options = Object.assign(
          {"serverURL":"https://waline.bipedalbit.net","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <div style="text-align: center;">
  当前页面浏览量: <span class="waline-pageview-count"></span>
</div>
<script type="module">
  import { pageviewCount } from 'https://unpkg.com/@waline/client@v3/dist/pageview.js';

  pageviewCount({
    serverURL: 'https://waline.bipedalbit.net/',
    path: window.location.pathname,
    // 可选配置项
    // selector: 'waline-pageview-count',
    // update: true,
  });

  // 等待数据加载完成，检查 span 内容是否为空
  setTimeout(() => {
    const span = document.querySelector('.waline-pageview-count');
    if (!span.textContent.trim()) {
      span.textContent = '1';
    }
  }, 1000); // 1秒后执行，确保数据加载完成
</script>

        </div>
      </div>
    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
